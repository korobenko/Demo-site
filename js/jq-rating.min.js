/*
 * jq-rating
 *
 * jQuery plugin to create stars based rating
 *
 * @author     ESL Education <web@esl-education.org>
 * @created     02.07.14
 * @updated     05.11.14
 * @version     1.0.3
 */
!function(t){var s,e;return e="jqRating",s=function(){function s(s,e){this.$this=t(s),this.settings={value:3.5,retainValue:null,levelsClasses:["level-xlow","level-low","level-medium","level-high","level-xhigh"],updateOn:"click",starsCount:5,basedOn:5,iconClass:"fa fa-star",editable:!1,onChange:null},this.$refs={starsContainer:null,base:null,hover:null,grade:null,starsBase:null,starsHover:null},this.levelClass=null,this.hoverValue=null,this.retainValue=null,this._init(e)}return s.prototype._init=function(t){return this._extendSettings(t),this.retainValue=this.settings.retainValue,this.$refs.starsContainer=this.$this.find("[data-jq-rating-stars]:first"),this.$refs.starsContainer.length||(this.$refs.starsContainer=this.$this),this.$refs.grade=this.$this.find("[data-jq-rating-grade]"),this._generateHtml(),this._applyBaseCss(),this._addEventsListeners(),this.setValue(this.settings.value)},s.prototype.destroy=function(){return this.$refs.starsInteraction.unbind("mouseover"),this.$refs.starsInteraction.unbind("click"),this.$refs.starsContainer.unbind("mouseleave"),this.$refs.starsContainer.empty(),this.$refs.starsContainer=null,this.$refs.base=null,this.$refs.hover=null,this.$refs.grade=null,this.$refs.starsBase=null,this.$refs.starsHover=null,this.$refs.formField=null,this.$this.removeClass("jq-rating"),this.levelClass&&this.$this.removeClass(this.levelClass),this.isEditable()?this.$this.removeClass("jq-rating--editable"):void 0},s.prototype.update=function(){return this.destroy(),this._init()},s.prototype.retain=function(t){return this.retainValue=t,this.render()},s.prototype.release=function(){return typeof this.retainValue!==!1&&typeof this.retainValue!==!1?(this.retainValue=null,this.render()):void 0},s.prototype._generateHtml=function(){var s,e,i,n;for(this.$this.addClass("jq-rating"),this.isEditable()&&this.$this.addClass("jq-rating--editable"),this.$refs.base=t('<span class="jq-rating-group" />'),this.$refs.hover=t('<span class="jq-rating-group--hover" />'),this.$refs.interaction=t('<span class="jq-rating-group--hover jq-rating-group--interaction" />'),e=[],s=i=0,n=this.settings.starsCount;n>=0?n>i:i>n;s=n>=0?++i:--i)e.push(['<span class="jq-rating-star">','<i class="'+this.settings.iconClass+'"></i>',"</span>"].join(""));return this.$refs.starsContainer.append(this.$refs.base).append(this.$refs.hover).append(this.$refs.interaction),this.$refs.base.append(t(e.join(""))),this.$refs.hover.append(t(e.join(""))),this.$refs.interaction.append(t(e.join(""))),this.$refs.starsBase=this.$refs.base.children(),this.$refs.starsHover=this.$refs.hover.children(),this.$refs.starsInteraction=this.$refs.interaction.children()},s.prototype._applyBaseCss=function(){var t;return this.$refs.starsContainer.length&&this.$refs.starsContainer.css({position:"relative",display:"inline-block"}),this.$refs.base.css({top:0,left:0}),t={position:"absolute",top:0,left:0,overflow:"hidden","white-space":"nowrap"},this.$refs.hover.css(t),this.$refs.interaction.css(t),this.$refs.starsBase.css({display:"inline-block"}),this.$refs.starsHover.css({display:"inline-block"}),this.$refs.starsInteraction.css({color:"transparent"})},s.prototype._addEventsListeners=function(){return this.$this.find("input[data-jq-rating-grade], textarea[data-jq-rating-grade]").on("change",function(t){return function(s){var e;return e=parseInt(s.currentTarget.value),0>e&&(e=0),e>t.settings.basedOn&&(e=t.settings.basedOn),t.setValue(e)}}(this)),this.isEditable()?(this.$refs.starsInteraction.bind("mouseover",function(s){return function(e){var i,n;return i=t(e.currentTarget).index()+1,n=s.settings.basedOn/s.settings.starsCount*i,"hover"===s.settings.updateOn?s.setValue(n):(s.hoverValue=n,s.render())}}(this)),this.$refs.starsInteraction.bind("click",function(s){return function(e){var i;return i=t(e.currentTarget).index()+1,s.setValue(s.settings.basedOn/s.settings.starsCount*i)}}(this)),this.$refs.starsContainer.bind("mouseleave",function(t){return function(){return t.hoverValue=null,t.render()}}(this))):void 0},s.prototype.setValue=function(s){return this.value=s,this.render(),this.$refs.grade.each(function(s){return function(e,i){switch(i.nodeName.toLowerCase()){case"textarea":case"input":return t(i).val(s.value).attr("value",s.value);default:return t(i).html(s.value)}}}(this)),this.settings.onChange&&this.settings.onChange(this.value,this),this.$this.trigger("jqRating.change")},s.prototype.render=function(){var t,s,e;return s=this.hoverValue||this.value,("number"==typeof this.retainValue||"string"==typeof this.retainValue)&&(s=this.retainValue),e=100/this.settings.basedOn*s,this.$refs.hover.css({width:e+"%"}),t=Math.round(this.settings.levelsClasses.length/this.settings.basedOn*s-1),0>t&&(t=0),t>=this.settings.levelsClasses.length&&(t=this.settings.levelsClasses.length-1),this.levelClass&&this.$this.removeClass(this.levelClass),this.levelClass="jq-rating--"+this.settings.levelsClasses[t],this.$this.addClass(this.levelClass)},s.prototype.isEditable=function(){var t;return t=this.settings.editable&&"true"===this.settings.editable},s.prototype._extendSettings=function(s){return null!=s&&(this.settings=t.extend(this.settings,s,!0)),t.each(this.$this.get(0).attributes,function(t){return function(s,e){var i;return i=e.name,i=i.substr("data-jq-rating-".length),(i=i.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()}))&&void 0!==t.settings[i]?t.settings[i]=e.value:void 0}}(this))},s}(),t.fn.jqRating=function(i){var n;return s.prototype[i]?(n=Array.prototype.slice.call(arguments,1),this.each(function(){var s;return s=t(this).data(e+"_api"),s[i].apply(s,n)})):"object"!=typeof i&&i?t.error("Method "+i+" does not exist on jQuery.jqRating"):(n=Array.prototype.slice.call(arguments),this.each(function(){var i,r;return i=t(this),null==i.data(e+"_api")||""===i.data(e+"_api")?(r=new s(this,n[0]),t(this).data(e+"_api",r)):void 0}))}}(jQuery);
